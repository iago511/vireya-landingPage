<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HydroCore ‚Äî Prot√≥tipo</title>

  <!-- Tailwind CDN (r√°pido para prot√≥tipo) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Ajustes leves para mockup */
    .card { background: white; border-radius: 1rem; box-shadow: 0 6px 18px rgba(13, 27, 58, 0.06); }
    .input { border: 1px solid #E6E9EE; border-radius: 10px; padding: 10px; width:100%; }
    .sidebar { background: linear-gradient(180deg,#0A1C47,#133066); color: #fff; }
    .small-muted { color:#6B7280; font-size:13px; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 font-inter antialiased">

  <div class="flex min-h-screen">

    <!-- SIDEBAR -->
    <aside class="sidebar w-64 p-6 flex flex-col gap-6">
      <div class="text-2xl font-bold">HydroCore</div>
      <nav class="flex-1">
        <ul class="space-y-2 text-sm">
          <li><button data-view="funcionarios" class="nav-btn flex items-center gap-3 w-full text-left px-3 py-2 rounded-lg hover:bg-white/5">üë§ Funcion√°rios</button></li>
          <li><button data-view="cargos" class="nav-btn flex items-center gap-3 w-full text-left px-3 py-2 rounded-lg hover:bg-white/5">üè∑Ô∏è Cargos</button></li>
          <li><button data-view="produtos" class="nav-btn flex items-center gap-3 w-full text-left px-3 py-2 rounded-lg hover:bg-white/5">‚öóÔ∏è Produtos</button></li>
          <li><button data-view="estoque" class="nav-btn flex items-center gap-3 w-full text-left px-3 py-2 rounded-lg hover:bg-white/5">üì¶ Estoque</button></li>
        </ul>
      </nav>
      <div class="small-muted">v0.1 ‚Ä¢ Prot√≥tipo</div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 flex flex-col">

      <!-- HEADER -->
      <header class="h-16 px-6 flex items-center justify-between bg-white border-b">
        <div id="page-title" class="font-semibold text-lg">Funcion√°rios</div>
        <div class="flex items-center gap-4">
          <div class="small-muted">Usu√°rio Admin</div>
          <button class="px-3 py-1 rounded-lg border">Logout</button>
        </div>
      </header>

      <!-- CONTENT -->
      <main class="p-6 flex-1 overflow-auto">

        <!-- FUNCION√ÅRIOS -->
        <section id="view-funcionarios" class="view active space-y-6">
          <div class="card p-6">
            <h2 class="text-xl font-semibold mb-4">Cadastro de Funcion√°rios</h2>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium">Nome</label>
                <input id="emp-nome" class="input mt-1" placeholder="Ex: Jo√£o Silva" />
                <p id="err-nome" class="text-xs text-red-600 mt-1 hidden"></p>
              </div>
              <div>
                <label class="block text-sm font-medium">E-mail</label>
                <input id="emp-email" class="input mt-1" placeholder="gerado automaticamente" />
                <p id="err-email" class="text-xs text-red-600 mt-1 hidden"></p>
              </div>
              <div>
                <label class="block text-sm font-medium">Cargo</label>
                <select id="emp-cargo" class="input mt-1">
                  <option value="">-- selecione --</option>
                </select>
                <p id="err-cargo" class="text-xs text-red-600 mt-1 hidden"></p>
              </div>
              <div>
                <label class="block text-sm font-medium">Telefone</label>
                <input id="emp-telefone" class="input mt-1" placeholder="(XX) XXXXX-XXXX" />
              </div>
              <div>
                <label class="block text-sm font-medium">Senha</label>
                <input id="emp-senha" type="password" class="input mt-1" placeholder="m√≠nimo 8 caracteres" />
                <p id="err-senha" class="text-xs text-red-600 mt-1 hidden"></p>
              </div>
              <div class="flex items-end gap-3 justify-end">
                <button id="emp-cancel" class="px-4 py-2 rounded-lg border">Cancelar</button>
                <button id="emp-save" class="px-4 py-2 rounded-lg bg-green-600 text-white">Salvar</button>
              </div>
            </div>
          </div>

          <div class="card p-4">
            <h3 class="font-semibold mb-3">Lista de Funcion√°rios</h3>
            <div class="overflow-auto">
              <table class="w-full text-sm">
                <thead class="text-xs text-slate-500">
                  <tr><th class="p-2 text-left">Nome</th><th class="p-2 text-left">E-mail</th><th class="p-2 text-left">Cargo</th><th class="p-2 text-left">Telefone</th><th class="p-2">A√ß√µes</th></tr>
                </thead>
                <tbody id="employees-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- CARGOS -->
        <section id="view-cargos" class="view hidden space-y-6">
          <div class="flex justify-between items-center">
            <h2 class="text-xl font-semibold">Gest√£o de Cargos</h2>
            <button id="open-add-role" class="px-4 py-2 rounded-lg bg-blue-600 text-white">Adicionar Cargo</button>
          </div>

          <div class="card p-4">
            <table class="w-full text-sm">
              <thead class="text-xs text-slate-500"><tr><th class="p-2 text-left">Cargo</th><th class="p-2">A√ß√µes</th></tr></thead>
              <tbody id="roles-tbody"></tbody>
            </table>
          </div>
        </section>

        <!-- PRODUTOS -->
        <section id="view-produtos" class="view hidden space-y-6">
          <div class="card p-6">
            <h2 class="text-xl font-semibold mb-4">Cadastro de Produtos</h2>
            <div class="grid grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium">Nome do Produto</label>
                <input id="prod-nome" class="input mt-1" />
              </div>
              <div>
                <label class="block text-sm font-medium">C√≥digo</label>
                <input id="prod-codigo" class="input mt-1" />
              </div>
              <div>
                <label class="block text-sm font-medium">Unidade de Medida</label>
                <select id="prod-unidade" class="input mt-1"><option>L</option><option>kg</option><option>g</option><option>ml</option></select>
              </div>
              <div class="col-span-2">
                <label class="block text-sm font-medium">Descri√ß√£o</label>
                <input id="prod-descricao" class="input mt-1" />
              </div>
              <div>
                <label class="block text-sm font-medium">Custo Unit√°rio (R$)</label>
                <input id="prod-custo" class="input mt-1" placeholder="0.00" />
              </div>
              <div class="col-span-3 flex justify-end gap-3">
                <button id="prod-clear" class="px-4 py-2 rounded-lg border">Limpar Formul√°rio</button>
                <button id="prod-add" class="px-4 py-2 rounded-lg bg-green-600 text-white">Adicionar Produto</button>
              </div>
            </div>
          </div>

          <div class="card p-4">
            <h3 class="font-semibold mb-3">Produtos Cadastrados</h3>
            <div class="overflow-auto">
              <table class="w-full text-sm">
                <thead class="text-xs text-slate-500"><tr><th class="p-2 text-left">C√≥digo</th><th class="p-2 text-left">Nome</th><th class="p-2 text-left">Unidade</th><th class="p-2 text-left">Custo</th><th class="p-2">A√ß√µes</th></tr></thead>
                <tbody id="products-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ESTOQUE -->
        <section id="view-estoque" class="view hidden space-y-6">
          <div class="flex justify-end gap-3">
            <!-- bot√£o gen√©rico desativado; usamos a√ß√µes por linha -->
          </div>

          <div class="card p-4">
            <h3 class="font-semibold mb-3">Estoque de Produtos</h3>
            <div class="overflow-auto">
              <table class="w-full text-sm">
                <thead class="text-xs text-slate-500"><tr><th class="p-2 text-left">Produto</th><th class="p-2 text-left">Quantidade Atual</th><th class="p-2 text-left">Unidade</th><th class="p-2 text-left">√öltima Atualiza√ß√£o</th><th class="p-2">A√ß√µes</th></tr></thead>
                <tbody id="inventory-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- MODALS -->
  <!-- Role Modal -->
  <div id="role-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center">
    <div class="card p-6 w-96">
      <h3 id="role-modal-title" class="font-semibold text-lg mb-3">Adicionar Cargo</h3>
      <input id="role-name" class="input w-full" placeholder="Nome do Cargo" />
      <div class="mt-4 flex justify-end gap-3">
        <button id="role-cancel" class="px-3 py-1 rounded-lg border">Cancelar</button>
        <button id="role-save" class="px-3 py-1 rounded-lg bg-green-600 text-white">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Inventory Modal -->
  <div id="inventory-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center">
    <div class="card p-6 w-96">
      <h3 id="inventory-modal-title" class="font-semibold text-lg mb-3">Registrar Entrada</h3>
      <label class="block text-sm">Produto</label>
      <select id="inv-prod" class="input mt-1 w-full">
        <option value="">-- selecione --</option>
      </select>
      <label class="block text-sm mt-3">Quantidade</label>
      <input id="inv-qty" class="input mt-1" placeholder="0" />
      <div class="mt-4 flex justify-end gap-3">
        <button id="inv-cancel" class="px-3 py-1 rounded-lg border">Cancelar</button>
        <button id="inv-save" class="px-3 py-1 rounded-lg bg-green-600 text-white">Salvar</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
    /***********************
     * Dados iniciais (in-memory)
     ***********************/
    let roles = ["Operador", "Engenheiro", "T√©cnico"];
    let employees = [
      { id: 1, nome: "Jo√£o Silva", email: "joao.silva@empresa.com", cargo: "Operador", telefone: "(11) 98765-4321" },
      { id: 2, nome: "Maria Souza", email: "maria.souza@empresa.com", cargo: "Engenheiro", telefone: "(11) 91234-5678" }
    ];
    let products = [
      { id: 1, codigo: "PRD-001", nome: "Coagulante X", descricao: "Coagulante para fase 1", unidade: "L", custo: 45.00 },
      { id: 2, codigo: "PRD-002", nome: "Pol√≠mero Y", descricao: "Pol√≠mero de flocula√ß√£o", unidade: "kg", custo: 120.50 }
    ];
    let inventory = [ { productId: 1, quantidade: 120, updatedAt: new Date().toISOString() }, { productId: 2, quantidade: 40, updatedAt: new Date().toISOString() } ];

    /***********************
     * Utilit√°rios
     ***********************/
    function fmtBRL(v) {
      if (typeof v !== "number") return "-";
      return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }
    function genEmailFromName(nome) {
      if (!nome) return "";
      const cleaned = nome.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase().trim().split(/\s+/).join('.');
      return cleaned + "@empresa.com";
    }

    /***********************
     * Navega√ß√£o entre views
     ***********************/
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const view = btn.getAttribute('data-view');
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + view).classList.remove('hidden');
        document.getElementById('view-' + view).classList.add('active');
        document.getElementById('page-title').innerText = view === 'funcionarios' ? 'Funcion√°rios' : view === 'cargos' ? 'Gest√£o de Cargos' : view === 'produtos' ? 'Produtos' : 'Estoque';
      });
    });

    /***********************
     * Renderizadores
     ***********************/
    function renderRoles() {
      const tbody = document.getElementById('roles-tbody');
      tbody.innerHTML = '';
      roles.forEach((r, i) => {
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `<td class="p-2">${r}</td>
                        <td class="p-2 flex gap-2">
                          <button data-edit-role="${i}" class="px-2 py-1 rounded bg-slate-100">Editar</button>
                          <button data-del-role="${i}" class="px-2 py-1 rounded bg-red-50 text-red-600">Excluir</button>
                        </td>`;
        tbody.appendChild(tr);
      });
      // bind
      tbody.querySelectorAll('[data-edit-role]').forEach(btn => {
        btn.addEventListener('click', (e) => { openRoleModal('edit', Number(btn.getAttribute('data-edit-role'))); });
      });
      tbody.querySelectorAll('[data-del-role]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const idx = Number(btn.getAttribute('data-del-role'));
          if (!confirm('Excluir cargo? Verifique funcion√°rios vinculados.')) return;
          roles.splice(idx,1);
          renderRoles(); renderRoleSelects();
        });
      });
    }

    function renderRoleSelects() {
      const sel = document.getElementById('emp-cargo');
      sel.innerHTML = `<option value="">-- selecione --</option>`;
      roles.forEach(r => { const o = document.createElement('option'); o.value = r; o.innerText = r; sel.appendChild(o); });
    }

    function renderEmployees() {
      const tbody = document.getElementById('employees-tbody');
      tbody.innerHTML = '';
      employees.forEach(emp => {
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `<td class="p-2">${emp.nome}</td><td class="p-2">${emp.email}</td><td class="p-2">${emp.cargo}</td><td class="p-2">${emp.telefone||''}</td>
          <td class="p-2 flex gap-2"><button data-edit-emp="${emp.id}" class="px-2 py-1 rounded bg-slate-100">Editar</button>
          <button data-del-emp="${emp.id}" class="px-2 py-1 rounded bg-red-50 text-red-600">Excluir</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-edit-emp]').forEach(btn => btn.addEventListener('click', () => editEmployee(Number(btn.getAttribute('data-edit-emp')))));
      tbody.querySelectorAll('[data-del-emp]').forEach(btn => btn.addEventListener('click', () => {
        const id = Number(btn.getAttribute('data-del-emp'));
        if (!confirm('Excluir funcion√°rio?')) return;
        employees = employees.filter(e => e.id !== id);
        renderEmployees();
      }));
    }

    function renderProducts() {
      const tbody = document.getElementById('products-tbody');
      tbody.innerHTML = '';
      products.forEach(p => {
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `<td class="p-2">${p.codigo}</td><td class="p-2">${p.nome}</td><td class="p-2">${p.unidade}</td><td class="p-2">${fmtBRL(p.custo)}</td>
          <td class="p-2 flex gap-2">
            <button data-edit-prod="${p.id}" class="px-2 py-1 rounded bg-slate-100">Editar</button>
            <button data-del-prod="${p.id}" class="px-2 py-1 rounded bg-red-50 text-red-600">Excluir</button>
          </td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-del-prod]').forEach(btn => btn.addEventListener('click', () => {
        const id = Number(btn.getAttribute('data-del-prod'));
        if (!confirm('Excluir produto?')) return;
        products = products.filter(x => x.id !== id);
        inventory = inventory.filter(x => x.productId !== id);
        renderProducts(); renderInventory(); renderInvSelect();
      }));
      // edit functionality (simple: fill form)
      tbody.querySelectorAll('[data-edit-prod]').forEach(btn => btn.addEventListener('click', () => {
        const id = Number(btn.getAttribute('data-edit-prod'));
        const p = products.find(x => x.id === id);
        if (!p) return;
        document.getElementById('prod-nome').value = p.nome;
        document.getElementById('prod-codigo').value = p.codigo;
        document.getElementById('prod-descricao').value = p.descricao;
        document.getElementById('prod-unidade').value = p.unidade;
        document.getElementById('prod-custo').value = p.custo;
        // remove old then user can press add to create duplicate; for true edit we'd need an edit id state ‚Äî kept simple here
        if (confirm('Deseja editar esse produto (o registro atual ser√° removido e o formul√°rio ficar√° preenchido)?')) {
          products = products.filter(x => x.id !== id);
          renderProducts(); renderInventory(); renderInvSelect();
        }
      }));
    }

    function renderInventory() {
      const tbody = document.getElementById('inventory-tbody');
      tbody.innerHTML = '';
      products.forEach(p => {
        const inv = inventory.find(i => i.productId === p.id) || { quantidade: 0, updatedAt: null };
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `<td class="p-2">${p.nome}</td><td class="p-2">${inv.quantidade}</td><td class="p-2">${p.unidade}</td><td class="p-2">${inv.updatedAt ? new Date(inv.updatedAt).toLocaleString() : '-'}</td>
          <td class="p-2 flex gap-2">
            <button data-inv-ent="${p.id}" class="px-2 py-1 rounded bg-slate-100">Entrada</button>
            <button data-inv-sai="${p.id}" class="px-2 py-1 rounded bg-red-50 text-red-600">Sa√≠da</button>
          </td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-inv-ent]').forEach(btn => btn.addEventListener('click', () => openInventoryModal('entrada', Number(btn.getAttribute('data-inv-ent')))));
      tbody.querySelectorAll('[data-inv-sai]').forEach(btn => btn.addEventListener('click', () => openInventoryModal('saida', Number(btn.getAttribute('data-inv-sai')))));
    }

    function renderInvSelect() {
      const sel = document.getElementById('inv-prod');
      sel.innerHTML = '<option value="">-- selecione --</option>';
      products.forEach(p => {
        const o = document.createElement('option'); o.value = p.id; o.innerText = `${p.nome} (${p.unidade})`; sel.appendChild(o);
      });
    }

    /***********************
     * Employee form logic
     ***********************/
    const empNome = document.getElementById('emp-nome');
    const empEmail = document.getElementById('emp-email');
    const empCargo = document.getElementById('emp-cargo');
    const empTelefone = document.getElementById('emp-telefone');
    const empSenha = document.getElementById('emp-senha');
    const empSave = document.getElementById('emp-save');
    const empCancel = document.getElementById('emp-cancel');

    empNome.addEventListener('input', () => {
      empEmail.value = genEmailFromName(empNome.value);
      hideError('nome'); hideError('email');
    });
    empEmail.addEventListener('input', () => hideError('email'));
    empSenha.addEventListener('input', () => hideError('senha'));

    function hideError(field) {
      const el = document.getElementById('err-' + field);
      if (el) { el.classList.add('hidden'); el.innerText = ''; }
    }
    function showError(field, msg) {
      const el = document.getElementById('err-' + field);
      if (el) { el.classList.remove('hidden'); el.innerText = msg; }
    }

    function validateEmployeeForm({ nome, email, cargo, senha }) {
      let ok = true;
      if (!nome || nome.trim().length < 3) { showError('nome', 'Nome obrigat√≥rio (min 3 caracteres)'); ok = false; }
      if (!email || !email.includes('@')) { showError('email', 'E-mail inv√°lido'); ok = false; }
      const used = employees.some(e => e.email === email);
      if (used) { showError('email', 'E-mail j√° cadastrado'); ok = false; }
      if (!cargo) { showError('cargo', 'Selecione um cargo'); ok = false; }
      if (senha && senha.length > 0 && senha.length < 8) { showError('senha', 'Senha deve ter ao menos 8 caracteres'); ok = false; }
      return ok;
    }

    empSave.addEventListener('click', () => {
      // coletar
      const dados = {
        nome: empNome.value.trim(),
        email: empEmail.value.trim(),
        cargo: empCargo.value,
        telefone: empTelefone.value.trim(),
        senha: empSenha.value
      };
      // limpar erros
      ['nome','email','cargo','senha'].forEach(hideError);

      if (!validateEmployeeForm(dados)) return;
      const id = employees.length ? Math.max(...employees.map(e=>e.id))+1 : 1;
      employees.push({ id, nome: dados.nome, email: dados.email, cargo: dados.cargo, telefone: dados.telefone });
      // limpar form
      empNome.value = ''; empEmail.value=''; empCargo.value=''; empTelefone.value=''; empSenha.value='';
      renderEmployees();
      alert('Funcion√°rio salvo (persist√™ncia tempor√°ria no navegador).');
    });

    empCancel.addEventListener('click', () => {
      empNome.value = ''; empEmail.value=''; empCargo.value=''; empTelefone.value=''; empSenha.value='';
      ['nome','email','cargo','senha'].forEach(hideError);
    });

    function editEmployee(id) {
      const emp = employees.find(e => e.id === id);
      if (!emp) return;
      empNome.value = emp.nome; empEmail.value = emp.email; empCargo.value = emp.cargo; empTelefone.value = emp.telefone; empSenha.value = '';
      // Deletar o registro atual para quando salvar evitar duplicar. (Simplifica√ß√£o)
      employees = employees.filter(e => e.id !== id);
      renderEmployees();
    }

    /***********************
     * Roles modal logic
     ***********************/
    const roleModal = document.getElementById('role-modal');
    const roleNameInput = document.getElementById('role-name');
    const openAddRoleBtn = document.getElementById('open-add-role');
    const roleSaveBtn = document.getElementById('role-save');
    const roleCancelBtn = document.getElementById('role-cancel');
    let roleEditingIndex = null;

    openAddRoleBtn.addEventListener('click', () => openRoleModal('add'));
    roleCancelBtn.addEventListener('click', () => closeRoleModal());
    roleSaveBtn.addEventListener('click', () => {
      const name = roleNameInput.value.trim();
      if (!name) return alert('Nome do cargo obrigat√≥rio');
      if (roleEditingIndex === null) roles.push(name); else roles[roleEditingIndex] = name;
      closeRoleModal(); roleNameInput.value=''; roleEditingIndex=null;
      renderRoles(); renderRoleSelects();
    });

    function openRoleModal(mode, index=null) {
      roleModal.classList.remove('hidden'); roleModal.classList.add('flex');
      document.getElementById('role-modal-title').innerText = mode === 'add' ? 'Adicionar Cargo' : 'Editar Cargo';
      if (mode === 'edit' && index !== null) { roleNameInput.value = roles[index]; roleEditingIndex = index; } else { roleNameInput.value=''; roleEditingIndex = null; }
    }
    function closeRoleModal() {
      roleModal.classList.add('hidden'); roleModal.classList.remove('flex');
    }

    /***********************
     * Products logic
     ***********************/
    const prodAdd = document.getElementById('prod-add'), prodClear = document.getElementById('prod-clear');
    prodAdd.addEventListener('click', () => {
      const nome = document.getElementById('prod-nome').value.trim();
      const codigo = document.getElementById('prod-codigo').value.trim();
      const descricao = document.getElementById('prod-descricao').value.trim();
      const unidade = document.getElementById('prod-unidade').value;
      const custo = parseFloat(document.getElementById('prod-custo').value || 0);
      if (!nome || !codigo) return alert('Nome e C√≥digo s√£o obrigat√≥rios');
      const id = products.length ? Math.max(...products.map(p=>p.id))+1 : 1;
      products.push({ id, codigo, nome, descricao, unidade, custo });
      // ensure inventory row
      if (!inventory.find(i=>i.productId===id)) inventory.push({ productId: id, quantidade: 0, updatedAt: null });
      renderProducts(); renderInventory(); renderInvSelect();
      // limpar form
      document.getElementById('prod-nome').value=''; document.getElementById('prod-codigo').value=''; document.getElementById('prod-descricao').value=''; document.getElementById('prod-custo').value='';
    });
    prodClear.addEventListener('click', () => { document.getElementById('prod-nome').value=''; document.getElementById('prod-codigo').value=''; document.getElementById('prod-descricao').value=''; document.getElementById('prod-custo').value=''; });

    /***********************
     * Inventory modal logic
     ***********************/
    const invModal = document.getElementById('inventory-modal');
    const invTitle = document.getElementById('inventory-modal-title');
    const invProd = document.getElementById('inv-prod');
    const invQty = document.getElementById('inv-qty');
    const invCancel = document.getElementById('inv-cancel');
    const invSave = document.getElementById('inv-save');
    let invMode = 'entrada';
    function openInventoryModal(mode, productId=null) {
      invMode = mode;
      invTitle.innerText = mode === 'entrada' ? 'Registrar Entrada' : 'Registrar Sa√≠da';
      invModal.classList.remove('hidden'); invModal.classList.add('flex');
      renderInvSelect();
      if (productId) invProd.value = productId;
      else invProd.value = '';
      invQty.value = '';
    }
    invCancel.addEventListener('click', () => { invModal.classList.add('hidden'); invModal.classList.remove('flex'); });
    invSave.addEventListener('click', () => {
      const pid = Number(invProd.value);
      const qty = parseFloat(invQty.value || 0);
      if (!pid || isNaN(qty) || qty <= 0) return alert('Selecione produto e informe quantidade maior que zero.');
      const it = inventory.find(x => x.productId === pid);
      if (it) {
        if (invMode === 'entrada') it.quantidade += qty; else it.quantidade = Math.max(0, it.quantidade - qty);
        it.updatedAt = new Date().toISOString();
      } else {
        inventory.push({ productId: pid, quantidade: invMode === 'entrada' ? qty : 0, updatedAt: new Date().toISOString() });
      }
      invModal.classList.add('hidden'); invModal.classList.remove('flex');
      renderInventory();
      alert('Movimenta√ß√£o registrada (persist√™ncia tempor√°ria).');
    });

    /***********************
     * Inicializa√ß√£o
     ***********************/
    function init() {
      renderRoles(); renderRoleSelects(); renderEmployees(); renderProducts(); renderInventory(); renderInvSelect();
    }
    init();

    // small UX: pressing Enter on some inputs triggers save
    document.getElementById('emp-senha').addEventListener('keydown', (e) => { if (e.key === 'Enter') empSave.click(); });
    document.getElementById('prod-custo').addEventListener('keydown', (e) => { if (e.key === 'Enter') prodAdd.click(); });

  </script>

</body>
</html>
